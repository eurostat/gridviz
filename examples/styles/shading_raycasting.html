<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gridviz hill shading raycasting example</title>
    <style>
        html,
        body {
            height: 100%;
            /* Ensure the parent elements have a height so that the map can take up 100% correctly */
            margin: 0;
            /* Remove default margins to prevent scrolling */
            overflow: hidden;
            /* Prevent potential scrollbars */
        }
    </style>
</head>

<body>
    <div id="map" style="height: 100%; width: 100%"></div>

    <script src="../../dist/gridviz.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gridviz-parquet@1.1.1"></script>
    <script>
        //define map with initial view
        const map = new gridviz.Map(document.getElementById('map'), {
            x: 4200000,
            y: 2800000,
            z: 30,
            backgroundColor: '#ede4cc',
        }).addZoomButtons()

        //define dataset
        const dataset = new gridviz.MultiResolutionDataset(
            [100, 200, 500, 1000, 2000, 5000, 10000, 20000],
            resolution => new gviz_par.TiledParquetGrid(map,
                "https://raw.githubusercontent.com/jgaffuri/tiled-euroDEM/main/pub/v1/tiles_" + resolution + "/"),
            { preprocess: (c) => c.v != undefined && c.v > 0 }
        )

        //define style
        const style = new gridviz.ShadingRayStyle({
            elevation: c => c.v
        })

        //hypsometric tints style
        const colors = ["#bbcc9e", "#dde4c7", "#e0ebd9", "#e9f0d1", "#ece8c1", "#e9d6ad", "#e7c18c", "#e2b470", "#dda255", "#de8f4e", "#d57751", "#c8705e", "#d38487", "#dca3a4", "#edc7c2"]
        const classNumber = colors.length
        const hypsoStyle = new gridviz.SquareColorCategoryWebGLStyle({
            viewScale: cells => {
                [min, max] = d3.extent(cells, c => c.v)
                const breaks = []
                for (let i = 1; i < classNumber; i++) breaks.push(min_ + (max - min) * i / classNumber)
                return gridviz.classifier(breaks)
            },
            code: (c, r, z, classifier) => classifier(c.v),
            color: { ...colors },
        })

        //add layer to map
        map.layers = [
            new gridviz.GridLayer(dataset, [hypsoStyle, style], {
                minPixelsPerCell: 2,
                cellInfoHTML: (c) => `Elevation: ${c.v}`
            })
        ]

    </script>
</body>

</html>