<!DOCTYPE html>
<html lang="en" style="height: 100%">
    <head>
        <meta name="viewport" content="maximum-scale=1.0, user-scalable=no" />
        <title>Gridviz - Kernel smoothing style</title>
    </head>

    <body style="margin: 0; height: 100%; font-family: Arial, Helvetica, sans-serif; overflow: hidden">
        <div id="viz-container" style="height: 100%; width: 100%"></div>

        <div
            style="
                position: absolute;
                left: 20px;
                top: 20px;
                width: auto;
                height: auto;
                padding: 10px;
                border: 0px;
                border-radius: 5px;
                background: #ffffffcc;
                line-height: 1.6;
                box-shadow: 5px 5px 5px grey;
            "
        >
            <input
                type="range"
                min="0.001"
                max="30"
                value="1"
                class="slider"
                id="sigma"
                style="width: 400px"
            />
        </div>

        <script src="../../dist/gridviz.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/gridviz-smoothing@1.0.1"></script>
        <script src="https://cdn.jsdelivr.net/npm/d3-color@3"></script>
        <script src="https://cdn.jsdelivr.net/npm/d3-interpolate@3"></script>
        <script src="https://cdn.jsdelivr.net/npm/d3-scale-chromatic@3"></script>
        <script>
            let containerDiv = document.getElementById('viz-container')
            const map = new gviz.Map(containerDiv).setGeoCenter({ x: 0, y: 0 }).setZoomFactor(0.02)

            //add layer
            map.addCSVGridLayer(
                'https://raw.githubusercontent.com/jgaffuri/tiledgrids/master/data/test/single.csv',
                //"https://raw.githubusercontent.com/jgaffuri/tiledgrids/master/data/test/small.csv",
                1,
                [
                    new gviz_sm.KernelSmoothingStyle({
                        value: (c) => +c.value,
                        sigma: (r, zf) => (r * 10) / 10,
                        factor: 30,
                        filterSm: (v) => v > 0.0005,
                        styles: [
                            new gviz.ShapeColorSizeStyle({
                                colorCol: 'ksmval',
                                color: (v, r, s) => d3.interpolateSpectral(1 - v / s.max),
                            }),
                            new gviz.TextStyle({
                                textCol: 'ksmval',
                                text: (v, r, s, z) => Math.floor(1000 * v) / 1000,
                                color: () => 'black',
                                fontSize: (v, r, s, z) => r * 0.3,
                            }),
                        ],
                    }),
                ]
            )

            //sigma selection
            document.getElementById('sigma').oninput = function () {
                //set sigma
                map.layers[0].styles[0].sigma = (r, zf) => (r * +this.value) / 10
                //redraw
                map.cg.redraw()
            }
        </script>
    </body>
</html>
