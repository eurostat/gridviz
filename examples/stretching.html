<!DOCTYPE html>
<html lang="en" style="height: 100%">

<head>
    <meta name="viewport" content="maximum-scale=1.0, user-scalable=no" />
    <title></title>
</head>

<body style="margin: 0; height: 100%; font-family: Arial, Helvetica, sans-serif; overflow: hidden">

    <div id="viz-container" style="height: 100%; width: 100%"></div>

    <div style="
                position: absolute;
                left: 20px;
                top: 20px;
                width: auto;
                height: auto;
                padding: 10px;
                border: 0px;
                border-radius: 5px;
                background: #ffffffcc;
                line-height: 1.6;
                box-shadow: 5px 5px 5px grey;
            ">
        Function:
        <select id="fun" style="font-size: 1em">
            <option value="pow">Power</option>
            <option value="powRev">Power inverse</option>
            <option value="expRev" selected>Logarithmic</option>
            <option value="exp">Exponential</option>
            <option value="circleLow">Circular</option>
            <option value="circleHigh">Circular inverse</option>
        </select>
        <div id="alphaText">Stretching parameter: -10</div>
        <input type="range" min="-30" max="0" step="1" value="-10" id="alphaExp"
            style="width: 300px; display: initial" />
        <input type="range" min="0" max="1" step="0.02" value="0.3" id="alphaPowCir"
            style="width: 300px; display: none" />
    </div>

    <script src="../dist/gridviz.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gridviz-eurostat@1.0.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-color@3"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-interpolate@3"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-scale-chromatic@3"></script>
    <script>
        let containerDiv = document.getElementById('viz-container')

        const app = new gviz.Map(containerDiv)
            .setGeoCenter({ x: 4000000, y: 2960000 })
            .setZoomFactor(600)

            .setBackgroundColor('black')
            .setLabelLayer(gviz_es.getEuronymeLabelLayer('EUR', '20', { dark: true }))
            .setBoundaryLayer(gviz_es.getEurostatBoundariesLayer())

            .addMultiScaleTiledGridLayer(
                [1000, 2000, 5000, 10000, 20000, 50000, 100000],
                (r) =>
                    'https://raw.githubusercontent.com/jgaffuri/tiledgrids/main/data/europe/population2/' +
                    r +
                    'm/',
                [
                    new gviz.SquareColorWGLStyle({
                        colorCol: 'TOT_P_2021',
                        color: d3.interpolateMagma,
                        stretching: { fun: 'expRev', alpha: -10 },
                    }),
                    new gviz.StrokeStyle({ maxZoom: 15 }),
                ],
                {
                    pixNb: 2,
                    cellInfoHTML: (c) => '<b>' + c.TOT_P_2021 + '</b> inhabitant' + (c.TOT_P_2021 == 1 ? '' : 's'),
                }
            )

        //update
        const s = app.layers[0].styles[0]
        const update = () => {

            //get stretching function
            const fun = document.querySelector('#fun').value

            //get alpha
            let a
            if (fun == 'exp' || fun == 'expRev') {
                document.getElementById('alphaExp').style.display = 'initial'
                document.getElementById('alphaPowCir').style.display = 'none'
                a = +document.querySelector('#alphaExp').value
            } else if (fun == 'pow' || fun == 'powRev' || fun == 'circleLow' || fun == 'circleHigh') {
                document.getElementById('alphaExp').style.display = 'none'
                document.getElementById('alphaPowCir').style.display = 'initial'
                a = +document.querySelector('#alphaPowCir').value
            }

            //set style stretching function
            s.stretching = { fun: fun, alpha: a }

            document.getElementById('alphaText').textContent = 'Stretching parameter: ' + a

            //redraw
            app.cg.redraw()
        }

        //
        document.getElementById('fun').addEventListener('change', update)
        document.getElementById('alphaExp').addEventListener('input', update)
        document.getElementById('alphaPowCir').addEventListener('input', update)
    </script>
</body>

</html>