<!DOCTYPE html>
<html lang="en" style="height: 100%">

<head>
    <meta name="viewport" content="maximum-scale=1.0, user-scalable=no" />
    <title></title>
</head>

<body style="margin: 0; height: 100%; font-family: Arial, Helvetica, sans-serif; overflow: hidden">
    <div id="viz-container" style="height: 100%; width: 100%"></div>

    <div style="
                position: absolute;
                left: 20px;
                top: 20px;
                width: auto;
                height: auto;
                padding: 10px;
                border: 0px;
                border-radius: 5px;
                background: #ffffffcc;
                line-height: 1.6;
                box-shadow: 5px 5px 5px grey;
            ">
        <span style="font-size: 1.8em; font-weight: bold">Population of France</span><br />
        <hr />
        <span style="font-size: 1.25em">
            <div id="style">
                By color:
                <input type="radio" name="style" id="scolor" value="scolor" checked />
                <label for="scolor">Square</label>
                <input type="radio" name="style" id="ccolor" value="ccolor" />
                <label for="ccolor">Circle</label>
                <br />
                By size:
                <input type="radio" name="style" id="square" value="square" />
                <label for="square">Square</label>
                <input type="radio" name="style" id="circle" value="circle" />
                <label for="circle">Circle</label>
                <input type="radio" name="style" id="diamond" value="diamond" />
                <label for="diamond">Diamond</label>
                <input type="radio" name="style" id="donut" value="donut" />
                <label for="donut">Donut</label>
                <br />
                As lines:
                <input type="radio" name="style" id="segmentH" value="segmentH" />
                <label for="segmentH">Horizontal</label>
                <input type="radio" name="style" id="segmentV" value="segmentV" />
                <label for="segmentV">Vertical</label>
                <input type="radio" name="style" id="segmentO" value="segmentO" />
                <label for="segmentO">Oblique</label>
                <br />
                Others:
                <input type="radio" name="style" id="joyplot" value="joyplot" />
                <label for="joyplot">Joyplot</label>
                <input type="radio" name="style" id="side" value="side" />
                <label for="side">Choco</label>
                <input type="radio" name="style" id="tanaka" value="tanaka" />
                <label for="tanaka">Tanaka</label>
                <br />
                <input type="radio" name="style" id="lego" value="lego" />
                <label for="lego">Lego</label>
                <input type="radio" name="style" id="pillar" value="pillar" />
                <label for="pillar">Pillar</label>
                <input type="radio" name="style" id="dot" value="dot" />
                <label for="dot">Dots</label>
                <input type="radio" name="style" id="text" value="text" />
                <label for="text">#@=€</label>
            </div>
            <hr />
            <input type="checkbox" id="label" checked />
            <label for="label">City names</label>
            <input type="checkbox" id="boundary" checked />
            <label for="boundary">Boundaries</label>
            <hr />
            Source:
            <a href="https://www.insee.fr/fr/statistiques/4176290?sommaire=4176305" target="_blank"
                rel="noopener noreferrer">INSEE - Filosofi 2015 - 200m grid</a>
        </span>
    </div>

    <script src="../dist/gridviz.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gridviz-eurostat@1.0.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-color@3"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-interpolate@3"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-scale-chromatic@3"></script>
    <script>
        let containerDiv = document.getElementById('viz-container')
        const app = new gviz.App(containerDiv)
            .setGeoCenter({ x: 3763437, y: 2891045 })
            .setZoomFactor(50.1)
            .setZoomFactorExtent([10, 1500])
            .setLabelLayer(gviz_es.getEuronymeLabelLayer('FR', '20'))
            .setBoundaryLayer(gviz_es.getEurostatBoundariesLayer())
            .setViewFromURL()

        const tsFun = gviz.TextStyle.getCharLegendFun(['.', '-', '~', '+', '=', '#', '€', '@'])

        //style data
        const sd = {
            scolor: {
                style: [
                    new gviz.SquareColorWGLStyle({
                        colorCol: 'ind',
                        color: d3.interpolateOrRd,
                        stretching: { fun: 'expRev', alpha: -7 },
                    }),
                    new gviz.StrokeStyle({ maxZoom: 15 }),
                ],
                pixNb: 2,
            },
            ccolor: {
                style: [
                    new gviz.ShapeColorSizeStyle({
                        colorCol: 'ind',
                        color: (v, r, s) => d3.interpolateOrRd(gviz.sPow(v / s.max, 0.25)),
                        shape: () => 'circle',
                    }),
                    new gviz.StrokeStyle({ maxZoom: 15, shape: () => 'circle' }),
                ],
                pixNb: 7,
            },

            square: {
                style: [
                    new gviz.ShapeColorSizeStyle({
                        color: () => '#c08c59cc',
                        sizeCol: 'ind',
                        size: (v, r, s, zf) => 1 * r * gviz.sPow(v / s.max, 0.3),
                        shape: () => 'square',
                    }),
                    new gviz.StrokeStyle({
                        maxZoom: 15,
                        sizeCol: 'ind',
                        size: (v, r, s, zf) => 1 * r * gviz.sPow(v / s.max, 0.3),
                    }),
                ],
                pixNb: 10,
            },
            circle: {
                style: [
                    new gviz.ShapeColorSizeStyle({
                        color: () => '#c08c59cc',
                        sizeCol: 'ind',
                        size: (v, r, s, zf) => 1.5 * r * gviz.sPow(v / s.max, 0.3),
                        shape: () => 'circle',
                    }),
                    new gviz.StrokeStyle({
                        maxZoom: 15,
                        sizeCol: 'ind',
                        size: (v, r, s, zf) => 1.5 * r * gviz.sPow(v / s.max, 0.3),
                        shape: () => 'circle',
                    }),
                ],
                pixNb: 10,
            },
            diamond: {
                style: [
                    new gviz.ShapeColorSizeStyle({
                        color: () => '#c08c59cc',
                        sizeCol: 'ind',
                        size: (v, r, s, zf) => 1.5 * r * gviz.sPow(v / s.max, 0.3),
                        shape: () => 'diamond',
                    }),
                    new gviz.StrokeStyle({
                        maxZoom: 15,
                        sizeCol: 'ind',
                        size: (v, r, s, zf) => 1.5 * r * gviz.sPow(v / s.max, 0.3),
                        shape: () => 'diamond',
                    }),
                ],
                pixNb: 10,
            },
            donut: {
                style: [
                    new gviz.ShapeColorSizeStyle({
                        sizeCol: 'ind',
                        size: (v, r, s, zf) => r * gviz.sPow(v / s.max, 0.3),
                        color: () => '#c08c59',
                        shape: () => 'donut',
                    }),
                ],
                pixNb: 15,
            },

            segmentH: {
                style: [
                    new gviz.SegmentStyle({
                        orientation: () => 0,
                        color: (v, r, s) => '#c08c59',
                        length: (v, r) => r,
                        widthCol: 'ind',
                        width: (v, r, s, zf) => r * gviz.sPow(v / s.max, 0.25),
                    }),
                ],
                pixNb: 10,
            },
            segmentV: {
                style: [
                    new gviz.SegmentStyle({
                        orientation: () => 90,
                        color: (v, r, s) => '#c08c59',
                        length: (v, r) => r,
                        widthCol: 'ind',
                        width: (v, r, s, zf) => r * gviz.sPow(v / s.max, 0.25),
                    }),
                ],
                pixNb: 10,
            },
            segmentO: {
                style: [
                    new gviz.SegmentStyle({
                        orientation: () => 45,
                        color: (v, r, s) => '#c08c59',
                        length: (v, r) => r * 1.4142,
                        widthCol: 'ind',
                        width: (v, r, s, zf) => (r * gviz.sPow(v / s.max, 0.25)) / 1.4142,
                    }),
                ],
                pixNb: 10,
            },

            joyplot: {
                style: [
                    new gviz.JoyPlotStyle({
                        heightCol: 'ind',
                        height: (v, r, s, zf) => 5 * r * Math.sqrt(v / s.max),
                        fillColor: () => '#c08c59bb',
                    }),
                ],
                pixNb: 7,
            },
            side: {
                style: [
                    new gviz.SideStyle({
                        valueCol: 'ind',
                        value: (v1, v2) => {
                            return (v2 != undefined ? +v2 : 0) - (v1 != undefined ? +v1 : 0)
                        },
                        color: (side, r, s, z) =>
                            (side.value > 0 && side.or === 'h') || (side.value < 0 && side.or === 'v')
                                ? 'black'
                                : 'white',
                        width: (side, r, s, z) => {
                            const max = Math.max(Math.abs(s.min), Math.abs(s.max))
                            return (
                                r *
                                (0.01 +
                                    0.333 *
                                    (side.or === 'v' ? 0.6 : 1) *
                                    gviz.sPow(Math.abs(side.value) / max, 0.3))
                            )
                        },
                        fillColor: (c) => '#e2c9b2',
                    }),
                ],
                pixNb: 7,
            },
            tanaka: {
                style: gviz.TanakaStyle.get('ind', {
                    tFun: (v, r, s, zf) => gviz.sExpRev((v - s.min) / (s.max - s.min), -7),
                }),
                pixNb: 7,
            },
            lego: {
                style: gviz.LegoStyle.get('ind', {
                    tFun: (v, r, s, zf) => gviz.sPow((v - s.min) / (s.max - s.min), 0.2),
                }),
                pixNb: 15,
            },
            pillar: {
                style: [
                    new gviz.PillarStyle({
                        heightCol: 'ind',
                        height: (v, r, s, z) => 15 * r * gviz.sPow(v / s.max, 0.7),
                    }),
                ],
                pixNb: 18,
            },
            dot: {
                style: [
                    new gviz.DotDensityStyle({
                        nbCol: 'ind',
                        nb: (v, r, s, zf) => (((5 * r * r) / (zf * zf)) * v) / s.max,
                        dotSize: (r, zf) => 1.2 * zf,
                        color: () => '#FF5733',
                    }),
                ],
                pixNb: 7,
            },
            text: {
                style: [
                    new gviz.TextStyle({
                        textCol: 'ind',
                        text: (v, r, s, z) => {
                            const t = gviz.sPow(v / s.max, 0.25)
                            return tsFun(t)
                        },
                        color: (v, r, s) => '#c08c59',
                        fontSize: (v, r, s, z) => 1.2 * r,
                    }),
                ],
                pixNb: 10,
            },
        }

        app.addMultiScaleTiledGridLayer(
            [200, 400, 600, 1000, 2000, 5000, 10000, 20000, 50000, 100000],
            (r) =>
                'https://raw.githubusercontent.com/jgaffuri/tiled-grid-france-filosofi/main/out/csv/met/inc/2019/' +
                r +
                'm/',
            sd.scolor.style,
            {
                pixNb: sd.scolor.pixNb,
                cellInfoHTML: (c) => '<b>' + c.ind + '</b> inhabitant(s)',
            }
        )

        //legends
        sd.scolor.style[0].legends.push(
            new gviz.ColorLegend({
                title: 'Number of inhabitants',
                ticks: 6,
                colorRamp: d3.interpolateOrRd,
                fun: (t, r, s) => s.max * gviz.sExpRevInverse(t, -7),
            })
        )
        sd.ccolor.style[0].legends.push(
            new gviz.ColorLegend({
                title: 'Number of inhabitants',
                ticks: 6,
                colorRamp: d3.interpolateOrRd,
                fun: (t, r, s) => s.max * Math.pow(t, 1 / 0.25),
            })
        )
        sd.square.style[0].legends.push(
            new gviz.SizeLegend({ shape: 'square', labelUnitText: 'inhab.', fillColor: '#c08c59cc' })
        )
        sd.circle.style[0].legends.push(
            new gviz.SizeLegend({ shape: 'circle', labelUnitText: 'inhab.', fillColor: '#c08c59cc' })
        )
        sd.segmentH.style[0].legends.push(
            new gviz.SegmentWidthLegend({ labelUnitText: 'inhab.', color: '#c08c59', orientation: 0 })
        )
        sd.segmentV.style[0].legends.push(
            new gviz.SegmentWidthLegend({ labelUnitText: 'inhab.', color: '#c08c59', orientation: 90 })
        )
        sd.segmentO.style[0].legends.push(
            new gviz.SegmentWidthLegend({ labelUnitText: 'inhab.', color: '#c08c59', orientation: 45 })
        )

        //style selector
        document.querySelector('#style').addEventListener('change', function () {
            //get checked value
            const value = document.querySelector('input[name="style"]:checked').value

            const lay = app.layers[0]

            //set new style
            lay.styles = sd[value].style

            //set new zoom breaks
            lay.pixNb = sd[value].pixNb

            //redraw
            app.cg.redraw()
        })

        // show/hide labels
        document.querySelector('#label').addEventListener('change', function () {
            app.showLabels = this.checked
            app.cg.redraw()
        })

        // show/hide boundaries
        document.querySelector('#boundary').addEventListener('change', function () {
            app.showBoundaries = this.checked
            app.cg.redraw()
        })
    </script>

    <div style="
                position: absolute;
                right: 0px;
                bottom: 0px;
                width: auto;
                height: auto;
                padding: 1px;
                border: 0px;
                background: #ffffffcc;
            ">
        <span style="font-size: 0.8em; font-family: sans-serif"><a target="_blank" rel="nofollow noreferrer noopener"
                href="https://github.com/eurostat/gridviz" style="text-decoration: none">GridViz</a>
            | ©
            <a target="_blank" rel="nofollow noreferrer noopener" href="https://eurogeographics.org"
                style="text-decoration: none">EuroGeographics</a>
            | ©
            <a target="_blank" rel="nofollow noreferrer noopener" href="https://www.tuik.gov.tr"
                style="text-decoration: none">Turkstat</a>
        </span>
    </div>
</body>

</html>